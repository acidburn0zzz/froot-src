Main Server Code
================

main.cc
-------

Handles command line arguments, creates a `Server` object and then
starts multiple threads for handling queries.

server.cc, server.h
-------------------

The main coordination class, which receives raw IP frames from the
network stack, creating a `Context` for each DNS query and subequently
passing the entire response back to the network stack.

Since the server uses raw sockets fragmentation of IP packets that
exceed the MTU is done here.

context.cc, context.h
---------------------

The `Context` class contains the state associated with an incoming
query, the functions for parsing that query into that state, look-up
of the corresponding answer for the query, and subsequent collation
of the entire response into the `iovec[]` which will be passed back
to the network layer.

answer.cc, answer.h
-------------------

Encapsulates a pre-computed `Answer`, and also sets of answers where
the latter contains an answer for each specific class of response
that can be generated by the server.

The `Answer` class only contains the Answer, Authority and Additional
sections of a response, with compression pointers pre-calculated
assuming the minimal possible QNAME in the Question section.

If the QNAME is longer than this then the `data_offset_by()` method
returns a copy of the answer with the compression pointers adjusted
to compensate for the additional size of the Question section.

buffer.h
--------

A pair of classes (`ReadBuffer` and `WriteBuffer`) which encapsulate
operations for sequentially reading or storing data into a memory
buffer.

The classes use C++ templates to handle automatic serialization of
compound objects in buffers.   For example,

```
auto& tx_hdr = head.reserve<dnshdr>();
```

reserves the amount of space required for a `dnshdr` object (adjusting
the offset for the next operation accordingly) and aliases that memory
space into the reference variable `tx_hdr` such that subsequent writes
to that variable's members will get written to the buffer.

packet.cc, packet.h
-------------------

A low-level class proving access to an `AF_PACKET` raw socket under
Linux with reads done using a memory-mapped `PACKET_RX_RING` to
increase performance.

rrlist.cc, rrlist.h
-------------------

The `RRList` contains both a list of resource records and the RRSIGs
associated with them.

util.cc, util.h
---------------

Miscellaneous utility functions that don't clearly fit into any
individual class.

zone.cc, zone.h
---------------

The `Zone` class handles loading a zone file in RFC 1035 master file
format, and then pre-compiling an `AnswerSet` for each TLD therein.

Benchmarking Code
=================

benchmark.cc
------------

Loads a 10M record file of queries and tests the throughput of a
`Context` in parsing and generating answers to those queries.  NB:
this does not execute the raw IP packet handling code, just memory
buffers containing queries and responses.

timer.cc, timer.h
-----------------

Operators for manipulating `timespec` objects, and a `BenchmarkTimer`
class that uses scoped RAII to measure the lifetime of a block of code.

queryfile.cc, queryfile.h
-------------------------

Loads queries from a binary data file, either in a raw binary
format or the text-based format used by `dnsperf`.
